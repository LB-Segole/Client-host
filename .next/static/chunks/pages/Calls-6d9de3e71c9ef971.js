(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[855],{8523:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Calls",function(){return s(3433)}])},1887:function(e,t,s){"use strict";s.d(t,{k:function(){return u}});var n=s(7294),r=s(8444),c=s(5293);class i extends c.EventEmitter{connect(){var e;if((null===(e=this.socket)||void 0===e?void 0:e.readyState)!==WebSocket.OPEN)try{this.socket=new WebSocket(this.config.url),this.setupSocketListeners()}catch(e){this.handleError(e)}}disconnect(){this.socket&&(this.clearReconnectTimer(),this.socket.close(),this.socket=null,this.reconnectCount=0)}send(e){if(!this.socket||this.socket.readyState!==WebSocket.OPEN)throw Error("WebSocket is not connected");let t={...e,timestamp:Date.now()};try{this.socket.send(JSON.stringify(t))}catch(e){this.handleError(e)}}getStatus(){if(!this.socket)return"disconnected";switch(this.socket.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:case WebSocket.CLOSED:default:return"disconnected"}}setupSocketListeners(){this.socket&&(this.socket.onopen=()=>{this.reconnectCount=0,this.emit("open"),this.send({type:"auth",payload:{token:this.config.token}})},this.socket.onclose=()=>{this.emit("close"),this.handleReconnect()},this.socket.onerror=e=>{this.handleError(e)},this.socket.onmessage=e=>{try{let t=JSON.parse(e.data);this.emit("message",t)}catch(e){this.handleError(Error("Failed to parse WebSocket message"))}})}handleError(e){let t=e instanceof Error?e.message:"Unknown WebSocket error";this.emit("error",Error(t))}handleReconnect(){var e;if(this.reconnectCount>=(null!==(e=this.config.reconnectAttempts)&&void 0!==e?e:3)){this.emit("error",Error("Max reconnection attempts reached"));return}this.clearReconnectTimer(),this.reconnectTimer=setTimeout(()=>{this.reconnectCount++,this.connect()},this.config.reconnectInterval)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}constructor(e){super(),this.socket=null,this.reconnectCount=0,this.reconnectTimer=null,this.config={reconnectAttempts:3,reconnectInterval:5e3,...e}}}let a=null,o=(e,t)=>(a||(a=new i({url:e,token:t})),a),l=()=>{if(!a)throw Error("WebSocket has not been initialized");return a},d=()=>{a&&(a.disconnect(),a=null)},h=(e,t)=>{let[s,r]=(0,n.useState)("disconnected"),[c,i]=(0,n.useState)([]),[a,h]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let s=o(e,t),n=()=>{r("connected"),h(null)},c=()=>{r("disconnected")},a=e=>{r("error"),h(e)},l=e=>{i(t=>[...t,e])};return s.on("open",n),s.on("close",c),s.on("error",a),s.on("message",l),s.connect(),()=>{s.off("open",n),s.off("close",c),s.off("error",a),s.off("message",l),d()}},[e,t]),{status:s,messages:c,error:a,send:(0,n.useCallback)(e=>{try{l().send(e)}catch(e){h(e instanceof Error?e:Error("Failed to send message"))}},[]),connect:()=>l().connect(),disconnect:()=>d()}},u=e=>{let[t,s]=(0,n.useState)(e),[c,i]=(0,n.useState)("idle"),[a,o]=(0,n.useState)(null),[l,d]=(0,n.useState)(null),{status:u,send:m}=h(t.websocketUrl,t.authToken),{playAudio:p,stopAudio:x}=(0,r.Q)(),f=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AGENT_ERROR";d(e instanceof Error?Object.assign(e,{code:t}):Object.assign(Error("Unknown error"),{code:t})),i("error")},[]),g=(0,n.useCallback)(async()=>{try{if("idle"!==c)throw Error("Agent can only be started from idle state");i("initializing"),m({type:"agent.start",payload:{config:t,timestamp:Date.now()}}),i("active")}catch(e){f(e,"AGENT_START_ERROR")}},[t,c,m,f]),y=(0,n.useCallback)(async()=>{try{if("idle"===c)return;m({type:"agent.stop",payload:{agentId:t.id}}),x(),i("idle"),o(null)}catch(e){f(e,"AGENT_STOP_ERROR")}},[t.id,c,m,x,f]),k=(0,n.useCallback)(async e=>{try{if("active"!==c)throw Error("Agent must be active to send messages");m({type:"agent.message",payload:{agentId:t.id,message:e,callId:null==a?void 0:a.id}})}catch(e){f(e,"AGENT_MESSAGE_ERROR")}},[t.id,null==a?void 0:a.id,c,m,f]),b=(0,n.useCallback)(async e=>{try{let s=await fetch("".concat(t.apiUrl,"/tts"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.authToken)},body:JSON.stringify({text:e})});if(!s.ok)throw Error("Speech synthesis failed");let n=await s.arrayBuffer();await p(n)}catch(e){f(e,"SPEECH_SYNTHESIS_ERROR")}},[t.apiUrl,t.authToken,p,f]);return(0,n.useEffect)(()=>{"error"===u&&f(Error("WebSocket connection error"),"WEBSOCKET_ERROR")},[u,f]),(0,n.useEffect)(()=>{(null==a?void 0:a.status)==="ended"&&y()},[null==a?void 0:a.status,y]),(0,n.useEffect)(()=>()=>{x(),"idle"!==c&&y()},[c,y,x]),{config:t,state:c,error:l,currentCall:a,setConfig:s,startAgent:g,stopAgent:y,sendMessage:k,synthesizeSpeech:b}}},3433:function(e,t,s){"use strict";s.r(t),s.d(t,{Calls:function(){return i}});var n=s(5893),r=s(7837);s(7294);var c=s(1887);let i=()=>{let{config:e}=(0,c.k)({id:"default",websocketUrl:"wss://api.voiceai.tech/v1/ws",apiUrl:"https://api.voiceai.tech/v1",authToken:"",voice:"en-US-Standard-A",speakingRate:1,pitch:0,language:"en-US"}),{data:t,isLoading:s}=(0,r.a)({queryKey:["calls"],queryFn:async()=>{let t=await fetch("".concat(e.apiUrl,"/calls"),{headers:{Authorization:"Bearer ".concat(e.authToken)}});if(!t.ok)throw Error("Failed to fetch calls");return t.json()}});return s?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Calls"}),(0,n.jsx)("button",{onClick:()=>{},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"New Call"})]}),(0,n.jsx)("div",{className:"mt-8 flex flex-col",children:(0,n.jsx)("div",{className:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,n.jsx)("div",{className:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8",children:(0,n.jsx)("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-300",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"ID"}),(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Status"}),(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Start Time"}),(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Duration"}),(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Participants"}),(0,n.jsx)("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:(0,n.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:null==t?void 0:t.map(e=>(0,n.jsxs)("tr",{className:"cursor-pointer hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.id}),(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm",children:(0,n.jsx)("span",{className:"inline-flex rounded-full px-2 text-xs font-semibold leading-5 ".concat("active"===e.status?"bg-green-100 text-green-800":"ended"===e.status?"bg-gray-100 text-gray-800":"error"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:e.status})}),(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:new Date(e.startTime).toLocaleString()}),(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.endTime?"".concat(Math.round((new Date(e.endTime).getTime()-new Date(e.startTime).getTime())/1e3/60),"m"):"Ongoing"}),(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.participants.join(", ")}),(0,n.jsx)("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:(0,n.jsx)("button",{onClick:e=>{e.stopPropagation()},className:"text-indigo-600 hover:text-indigo-900",children:"View details"})})]},e.id))})]})})})})})]})})};t.default=i}},function(e){e.O(0,[826,888,774,179],function(){return e(e.s=8523)}),_N_E=e.O()}]);